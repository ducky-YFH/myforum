<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>首页</title>
  <link rel="stylesheet" href="__CSS__/reset.css">
  <link rel="stylesheet" href="__STATIC__/common/layui/css/layui.css" media="all">
  <link rel="stylesheet/less" href="__CSS__/admin/index.less">
  <link rel="stylesheet/less" href="__CSS__/admin/nav.less">
  <script src="__CSS__/admin/less.js"></script>
</head>

<body>
  <div id="wrapper">
    <div class="topNav">
      <span class="top-icon"></span>
      <span class="top-logo">DaHeiShuai</span>
      <a class="top-logout" href="{:url('yefh_forum_admin/admin/aLogout')}">注销</a>
    </div>
    <div class="sideNav">
      <div class="side-avatar">
        <img src="__STATIC__/upload/avatar/猫咪头像.jpg" alt="">
      </div>
      <div class="side-username">
        {$Think.session.user}
      </div>
      <ul class="side-action">
        <li class="side-active">
          <a href="{:url('yefh_forum_admin/deal/index')}">
            <span class="layui-icon layui-icon-chart"></span>
            <span>首页</span>
          </a>
        </li>
        <li>
          <a href="{:url('yefh_forum_admin/deal/mesdeal')}">
            <span class="layui-icon layui-icon-tabs"></span>
            <span>帖子管理</span>
          </a>
        </li>
        <li>
          <a href="{:url('yefh_forum_admin/deal/userdeal')}">
            <span class="layui-icon layui-icon-user"></span>
            <span>用户管理</span>
          </a>
        </li>
        <li>
          <a href="{:url('yefh_forum_admin/deal/sectiondeal')}">
            <span class="layui-icon layui-icon-template-1"></span>
            <span>模板管理</span>
          </a>
        </li>
        <li>
          <a href="{:url('yefh_forum_admin/deal/recycledeal')}">
            <span class="layui-icon layui-icon-delete"></span>
            <span>回收站管理</span>
          </a>
        </li>
        <li>
          <a href="{:url('yefh_forum_admin/advdeal/ad')}">
            <span class="layui-icon layui-icon-website"></span>
            <span>广告管理</span>
          </a>
        </li>
        <li>
          <a href="{:url('yefh_forum_admin/advdeal/slidedeal')}">
            <span class="layui-icon layui-icon-picture"></span>
            <span>轮播图管理</span>
          </a>
        </li>
        <li>
          <a href="{:url('yefh_forum_admin/admin/apa')}">
            <span class="layui-icon layui-icon-face-smile-b"></span>
            <span>我的</span>
          </a>
        </li>
        <li>
          <a href="{:url('yefh_forum/index/index')}">
            <span class="layui-icon layui-icon-fonts-html"></span>
            <span>论坛前台</span>
          </a>
        </li>
      </ul>
    </div>
    <div class="content">
      <h1>数据统计</h1>
      <div class="chart">
        <div id="bar" style="width: 600px;height:400px;"></div>
        <div id="pie" style="width: 400px;height:400px;"></div>
      </div>
    </div>
  </div>
</body>

<script src="__JS__/echarts.min.js"></script>
<script src="__STATIC__/common/jquery/jquery.js" charset="utf-8"></script>

<script>
  // 获取后台数据
  let data = []
  $.ajax({
    type: "get",
    url: "foruminfo",
    data: "",
    dataType: "JSON",
    success: function (response) {
      data = response
      console.log(data)
      barOption(data)
      pieOption(data)
    }
  });
  function barOption(data) {
    let xAxis = [];
    let seriesData = [];
    let colorList = [];
    data.forEach((item, index) => {
      xAxis.push(item.sname)
      seriesData.push(item.num)
      colorList.push(`#${Math.random().toString(16).slice(2, 8)}`)
    })
    console.log(colorList);
    // 指定图表的配置项和数据
    var barOption = {
      tooltip: {},
      legend: {
        data: ['销量']
      },
      xAxis: {
        data: xAxis
      },
      yAxis: {},
      series: [
        {
          type: 'bar',
          data: seriesData,
          itemStyle: {
            normal: {
              color: function (params) {
                return colorList[params.dataIndex]
              }
            }
          }
        }
      ],
    };
    var barChart = echarts.init(document.getElementById('bar'));
    barChart.setOption(barOption);
  }
  // 基于准备好的dom，初始化echarts实例
  function pieOption(data) {
    let legend = [];
    let seriesData = [];
    data.forEach((item, index) => {
      legend.push(item.sname)
      seriesData.push({ value: item.num, name: item.sname })
    })
    var pieOption = {
      legend: {
        data: legend
      },
      series: [
        {
          name: '访问来源',
          type: 'pie',
          //饼状图
          // radius: ['50%', '70%'],
          avoidLabelOverlap: false,
          //标签
          label: {
            normal: {
              show: true,
              position: 'inside',
              formatter: '{d}%',//模板变量有 {a}、{b}、{c}、{d}，分别表示系列名，数据名，数据值，百分比。{d}数据会根据value值计算百分比

              textStyle: {
                align: 'center',
                baseline: 'middle',
                fontFamily: '微软雅黑',
                fontSize: 15,
                fontWeight: 'bolder'
              }
            },
          },
          data: seriesData
        }
      ]
    }
    var pieChart = echarts.init(document.getElementById('pie'));
    pieChart.setOption(pieOption);
  }
</script>

</html>