<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <link rel="stylesheet" href="__CSS__/reset.css">
  <link rel="stylesheet/less" href="__CSS__/admin/nav.less">
  <link rel="stylesheet/less" href="__CSS__/admin/table.less">
  <link rel="stylesheet/less" href="__CSS__/admin/selectbox.less">
  <link rel="stylesheet" href="__STATIC__/common/layui/css/layui.css" media="all">
  <link rel="stylesheet/less" href="__CSS__/admin/userdeal.less">
  <script src="__CSS__/admin/less.js"></script>
</head>
<script src="__STATIC__/common/jquery/jquery.js" charset="utf-8"></script>

<body>
  <div class="topNav">
    <span class="top-icon"></span>
    <span class="top-logo">DaHeiShuai</span>
    <a class="top-logout">注销</a>
  </div>
  <div class="sideNav">
    <div class="side-avatar">
      <img src="__STATIC__/upload/avatar/猫咪头像.jpg" alt="">
    </div>
    <div class="side-username">
      大黑帅
    </div>
    <ul class="side-action">
      <li>
        <a href="{:url('yefh_forum_admin/index/index')}">
          <span class="layui-icon layui-icon-chart"></span>
          <span>首页</span>
        </a>
      </li>
      <li>
        <a href="{:url('yefh_forum_admin/index/mesdeal')}">
          <span class="layui-icon layui-icon-tabs"></span>
          <span>帖子管理</span>
        </a>
      </li>
      <li class="side-active">
        <a href="{:url('yefh_forum_admin/index/userdeal')}">
          <span class="layui-icon layui-icon-user"></span>
          <span>用户管理</span>
        </a>
      </li>
      <li>
        <a href="{:url('yefh_forum_admin/index/sectiondeal')}">
          <span class="layui-icon layui-icon-template-1"></span>
          <span>模板管理</span>
        </a>
      </li>
      <li>
        <a href="{:url('yefh_forum_admin/index/recycledeal')}">
          <span class="layui-icon layui-icon-delete"></span>
          <span>回收站管理</span>
        </a>
      </li>
      <li>
        <a href="{:url('yefh_forum_admin/index/ADdeal')}">
          <span class="layui-icon layui-icon-website"></span>
          <span>广告管理</span>
        </a>
      </li>
      <li>
        <a href="{:url('yefh_forum_admin/index/slideShowdeal')}">
          <span class="layui-icon layui-icon-picture"></span>
          <span>轮播图管理</span>
        </a>
      </li>
      <li>
        <a href="{:url('yefh_forum_admin/index/reception')}">
          <span class="layui-icon layui-icon-fonts-html"></span>
          <span>论坛前台</span>
        </a>
      </li>
    </ul>
  </div>
  <div class="content">
    <h1>用户管理</h1>
    <table class="table">
      <!-- Replace "table" with any of the design numbers -->
      <thead>
        <th>序号</th>
        <th>昵称</th>
        <th>电话</th>
        <th>邮箱</th>
        <th>头像</th>
        <th>用户权限</th>
        <th>操作</th>
      </thead>
      <tbody>
        {volist name="user" id="item" key="i"}
        <tr>
          <td>{$i}</td>
          <td class="unick">{$item.unick}</td>
          <td>{$item.utel}</td>
          <td>{$item.uemail}</td>
          <td><img class="avatar" src="__STATIC__\upload\avatar\{$item.uimg}" alt=""></td>
          <td class="cur-power">{$item.power}</td>
          <td>
            <button type="button" class="editBtn layui-btn layui-btn-normal layui-btn-sm">修改权限</button>
          </td>
        </tr>
        {/volist}
      </tbody>
    </table>
    <div class="select-box">
      <div class="select-title">
        <span>用户名</span>
        <span></span>
        <span class="select-quit">X</span>
      </div>
      <div class="select-content">
        <label>
          <input class="radio_type" type="radio" name="power" , value="能正常登录，正常发言" checked>
          <span>正常登录，正常发言</span>
        </label>
        <label>
          <input class="radio_type" type="radio" name="power" value="能正常登录，禁止发言">
          <span>正常登录，不能发言</span>
        </label>
        <label>
          <input class="radio_type" type="radio" name="power" value="禁止登录，禁止发言">
          <span>不能登录，不能发言</span>
        </label>
        <button class="select-btn layui-btn layui-btn-normal layui-btn-sm">确定修改</button>
      </div>
    </div>
    <div class="cover"></div>
  </div>
</body>
<script>
  // --------------选择框操作--------------
  $(function () {
    let $unick, $curpower = '';
    let $editBtn = $(".editBtn")
    let $selectList = ['能正常登录，正常发言', '能正常登录，禁止发言', '禁止登录，禁止发言']
    // 根据不同权限添加颜色
    updateColor()
    // 修改
    $($editBtn).on('click', (e) => {
      $unick = $(e.target).parent('td').siblings('.unick').html();
      $curpower = $(e.target).parent('td').siblings('.cur-power');
      $('.select-box, .cover').show();
      $('.select-box .select-title > span:eq(1)').html($unick)
    })
    // 取消
    $('.select-quit').on('click', () => {
      $('.select-box, .cover').hide();
    })
    // 确定
    $('.select-btn').on('click', () => {
      let $power = $(".select-content input:checked").val();
      $.ajax({
        type: "post",
        url: "userpower",
        data: { power: $power, unick: $unick },
        dataType: "JSON",
        success: function (response) {
          response.success == 1 ? alert('修改成功') : alert('选择为当前的，请选择其他的')
          $curpower.html($power)
          updateColor()
        }
      });
      $('.select-box, .cover').hide();
    })
    // 根据不同权限设置颜色
    function updateColor() {
      $('tbody .cur-power').each((index, item) => {
        let $item = $(item)
        if ($item.html() === $selectList[1]) {
          $(item).css('color', '#ffd777')
        } else if ($item.html() === $selectList[2]) {
          $(item).css('color', 'red')
        } else {
          $(item).css('color', '#63b173')
        }
      })
    }
  })
</script>

</html>