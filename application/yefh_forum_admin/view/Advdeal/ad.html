<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>广告管理</title>
  <link rel="stylesheet" href="__CSS__/reset.css">
  <link rel="stylesheet" href="__CSS__/admin/table.css">
  <link rel="stylesheet" href="__CSS__/admin/ad.css">
  <link rel="stylesheet" href="__CSS__/admin/selectbox.css">
  <link rel="stylesheet" href="__STATIC__/common/layui/css/layui.css" media="all">
  <link rel="stylesheet" href="__STATIC__/common/toast/toast.css" media="all">
  <link rel="stylesheet" href="__CSS__/admin/nav.css">

</head>

<body>
  <!-- 顶部栏 -->
  <div class="topNav">
    <span class="top-icon"></span>
    <span class="top-logo">DaHeiShuai</span>
    <a class="top-logout" href="{:url('yefh_forum_admin/admin/aLogout')}">注销</a>
  </div>
  <!-- 侧边栏 -->
  <div class="sideNav">
    <div class="side-avatar">
      <img src="__STATIC__/upload/avatar/猫咪头像.jpg" alt="">
    </div>
    <div class="side-username">
      大黑帅
    </div>
    <ul class="side-action">
      <li>
        <a href="{:url('yefh_forum_admin/deal/index')}">
          <span class="layui-icon layui-icon-chart"></span>
          <span>首页</span>
        </a>
      </li>
      <li>
        <a href="{:url('yefh_forum_admin/deal/mesdeal')}">
          <span class="layui-icon layui-icon-tabs"></span>
          <span>帖子管理</span>
        </a>
      </li>
      <li>
        <a href="{:url('yefh_forum_admin/deal/userdeal')}">
          <span class="layui-icon layui-icon-user"></span>
          <span>用户管理</span>
        </a>
      </li>
      <li>
        <a href="{:url('yefh_forum_admin/deal/sectiondeal')}">
          <span class="layui-icon layui-icon-template-1"></span>
          <span>模板管理</span>
        </a>
      </li>
      <li>
        <a href="{:url('yefh_forum_admin/bindeal/binsec')}">
          <span class="layui-icon layui-icon-delete"></span>
          <span>回收站管理</span>
        </a>
      </li>
      <li class="side-active">
        <a href="{:url('yefh_forum_admin/advdeal/ad')}">
          <span class="layui-icon layui-icon-website"></span>
          <span>广告管理</span>
        </a>
      </li>
      <li>
        <a href="{:url('yefh_forum_admin/advdeal/slidedeal')}">
          <span class="layui-icon layui-icon-picture"></span>
          <span>轮播图管理</span>
        </a>
      </li>
      <li>
        <a href="{:url('yefh_forum_admin/admin/apa')}">
          <span class="layui-icon layui-icon-face-smile-b"></span>
          <span>我的</span>
        </a>
      </li>
      <li>
        <a href="{:url('yefh_forum/index/index')}">
          <span class="layui-icon layui-icon-fonts-html"></span>
          <span>论坛前台</span>
        </a>
      </li>
    </ul>
  </div>
  <!-- 内容栏 -->
  <div class="content">
    <table class="table">
      <div class="title">
        <span>首页广告管理</span>
        <a class="layui-btn layui-btn-primary layui-btn-sm" href="{:url('yefh_forum_admin/advdeal/addadv')}">添加广告</a>
      </div>
      <!-- Replace "table" with any of the design numbers -->
      <thead>
        <th>序号</th>
        <th>图片</th>
        <th>标题</th>
        <th>发布时间</th>
        <th>文字介绍</th>
        <th>指向地址</th>
        <th>审核结果</th>
        <th>操作</th>
      </thead>
      <tbody>
        {volist name="ad" id="item"}
        <tr>
          <td class="aid">{$item.aid}</td>
          <td><img class="aimg" src="__STATIC__/upload/advimage/ad/{$item.aimg}" alt=""></td>
          <td>{$item.atitle}</td>
          <td>{$item.atime|date="Y:m:d h:m:s",###}</td>
          <td>{$item.aremark}</td>
          <td><a href="{$item.ahref}">{$item.ahref}</a></td>
          <td class="cur-power">{$item.acheck}</td>
          <td>
            <a href="{:url('yefh_forum_admin/advdeal/alteradv',['aid'=>$item.aid])}"
              class="editBtn layui-btn layui-btn-normal layui-btn-sm">修改</a href="{:url('alteradv')}">
            <button type="button" class="audit layui-btn layui-btn-primary layui-btn-sm">审核</button>
            <button type="button" class="delBtn layui-btn layui-btn-danger layui-btn-sm">删除</button>
          </td>
        </tr>
        {/volist}
      </tbody>
    </table>
    <div class="select-box">
      <div class="select-title">
        <span></span>
        <span></span>
        <span class="select-quit layui-icon layui-icon-close"></span>
      </div>
      <div class="select-content">
        <label>
          <input class="radio_type" type="radio" name="power" , value="审核通过" checked>
          <span>审核通过</span>
        </label>
        <label>
          <input class="radio_type" type="radio" name="power" value="等待审核">
          <span>等待审核</span>
        </label>
        <label>
          <input class="radio_type" type="radio" name="power" value="暂停使用">
          <span>暂停使用</span>
        </label>
        <button class="select-btn layui-btn layui-btn-normal layui-btn-sm">确定修改</button>
      </div>
    </div>
    <div class="cover"></div>
  </div>
</body>
<script src="__STATIC__/common/jquery/jquery.js" charset="utf-8"></script>
<script src="__STATIC__/common/toast/toast.js" charset="utf-8"></script>

<script>
  $(function () {
    // 删除按钮
    $('.delBtn').on('click', function (e) {
      let $aid = $(e.target).parent('td').siblings('.aid').html();
      $tr = $(this).parents('tr')
      delAdv($tr,$aid);
    })
    let toast = new Toast()
    // 广告审核功能
    let $unick, $curpower = '';
    let $audit = $(".audit")
    let $selectList = ['审核通过', '等待审核', '暂停使用']
    // 根据不同权限添加颜色
    updateColor()
    // 审核按钮
    $($audit).on('click', (e) => {
      $aid = $(e.target).parent('td').siblings('.aid').html();
      $curpower = $(e.target).parent('td').siblings('.cur-power');
      $('.select-box, .cover').show(300);
      $('.select-box .select-title > span:eq(1)').html($unick)
    })
    // 取消按钮
    $('.select-quit').on('click', () => {
      $('.select-box, .cover').hide(300);
    })
    // 确定按钮
    $('.select-btn').on('click', () => {
      let $power = $(".select-content input:checked").val();
      $('.select-box, .cover').hide(300);
      $.ajax({
        type: "post",
        url: "auditad",
        data: { 'aid': $aid, 'power': $power },
        dataType: "JSON",
        success: function (res) {
          if (res.success == 1) {
            toast.success('更换成功')
            $curpower.html($power)
            updateColor()
          }
        }
      });
    })
    // 删除功能
    function delAdv(tr, aid) {
      $.ajax({
        type: "post",
        url: "delAdv",
        data: { 'aid': aid },
        dataType: "JSON",
        success: function (res) {
          if (res.success == 1) {
            toast.success('删除成功！')
            tr.remove()
          }else{
            toast.danger('删除失败！')
          }
        }
      });
    }
    // 根据不同权限设置颜色
    function updateColor() {
      $('tbody .cur-power').each((index, item) => {
        let $item = $(item)
        if ($item.html() === $selectList[1]) {
          $(item).css('color', '#ffd777')
        } else if ($item.html() === $selectList[2]) {
          $(item).css('color', 'red')
        } else {
          $(item).css('color', '#63b173')
        }
      })
    }
  })
</script>

</html>